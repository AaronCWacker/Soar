# Possible o_id propagation problem.  

learn --on
watch --learn 2

sp {init
   (state <s> ^superstate nil)
-->
   (<s> ^word object)

}

sp {propose*stop
   (state <s> ^superstate.superstate.superstate nil)
-->
    (write (crlf) |Too deep.|)
    (interrupt)
}

sp {propose
    (state <s> ^superstate <ss>)
    (<ss> ^superstate nil
          ^word <w>)
-->
    (<s> ^operator <o> + =)
    (<o> ^word1 <w>
         ^word2 <w>)
}

sp {apply*loose*constraint
    (state <s> ^superstate <ss>
               ^operator <o>)
    (<o> ^word1 <> not-object)
    -->
    (<s> ^sub-result1 1 +)
}

sp {apply*literalization
    (state <s> ^superstate <ss>
               ^operator <o>)
    (<o> ^word2 object)
    -->
    (<s> ^sub-result2 1 +)
}

sp {start-chunking2
    (state <s> ^superstate <ss>
               ^operator <o>
               ^sub-result1 <r> 
               ^sub-result2 <r>)
    (<o> ^word1 <object> ^word2 <object2>)
    -->
    (<ss> ^result <object> +
          ^result2 <object2> +)
}

# Attempt to get constraint that won't propagate or attach to wrong thing

srand 23
learn --on

sp {init-superstate
    (state <s> ^superstate nil)
-->
    (<s> ^i1 1 ^i2 2 ^i3 3 ^i4 4)
    (write (crlf) |Starting chunking unit test.|)
}

sp {propose*top
    (state <s> ^superstate nil)
-->
    (<s> ^operator <o>)
    (<o> ^name do-test)
}

sp {apply*test-done
    (state <s> ^superstate nil ^test-done)
-->
    (write (crlf) |Chunk produced. Test completed.|)
    (exec succeeded)
    (halt)
}

sp {apply*test-failed
    (state <s> ^superstate.superstate.superstate.superstate nil)
-->
    (write (crlf) |Chunk not produced.  Test failed.|)
    (halt)
}

sp {init-substate
    (state <s> ^superstate.superstate nil)
-->
    (<s> ^name substate
         ^ungrounded 5)}

sp {propose*test
    (state <s> ^name substate)
-->
    (<s> ^operator <o> +)
    (<o> ^name test)}

sp {apply-bt1
    (state <s> ^name substate
               ^operator.name test
               ^superstate <ss>
               ^ungrounded { > <i3> <big>})
    (<ss> ^i3 {<=> <big> <= <big> <i3>})
-->
    (<s> ^continue true)
}

sp {apply2
    (state <s> ^name substate
               ^operator.name test
               ^continue
               ^ungrounded <u>
               ^superstate <ss>)
    (<ss> ^i3 <i3>)
-->
    (<ss> ^result <u>)
}